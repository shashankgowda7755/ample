<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gift A Watch - Certificate Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'inter': ['Inter', 'sans-serif'], 'playfair': ['Playfair Display', 'serif'] },
                    animation: { 'fade-in': 'fadeIn 0.3s ease-out' },
                    keyframes: { fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } } }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #050505;
            color: #fff;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-active:active {
            transform: scale(0.98);
        }

        /* Ensure buttons are always on top */
        button {
            position: relative;
            z-index: 50;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const STEPS = { HERO: 'hero', FORM: 'form', PREVIEW: 'preview', SUCCESS: 'success' };

        // Internal SVG for default photo to prevent CORS/Loading issues
        const DEFAULT_AVATAR = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100' fill='%231a1a1a'%3E%3Crect width='100' height='100' fill='%23222'/%3E%3Ctext x='50' y='50' font-family='Arial' font-size='40' fill='%23444' text-anchor='middle' dy='.3em'%3E%3C/text%3E%3C/svg%3E";

        // 1. Poster Template
        const Poster = ({ data, innerRef }) => (
            <div ref={innerRef} style={{ width: '1080px', height: '1440px', position: 'relative', backgroundColor: '#050505', color: 'white', overflow: 'hidden', fontFamily: 'Playfair Display' }}>
                <div style={{ position: 'absolute', inset: 0, background: 'radial-gradient(circle at 50% 0%, #1a1005 0%, #000000 100%)' }}></div>
                <div style={{ position: 'absolute', inset: 0, border: '20px double rgba(245, 158, 11, 0.2)' }}></div>
                <div style={{ position: 'relative', zIndex: 10, padding: '100px 60px', textAlign: 'center', display: 'flex', flexDirection: 'column', height: '100%', alignItems: 'center' }}>
                    <div style={{ marginBottom: '60px' }}>
                        <div style={{ fontFamily: 'Inter', textTransform: 'uppercase', letterSpacing: '8px', fontSize: '24px', color: '#d97706', marginBottom: '20px' }}>Certificate of Appreciation</div>
                        <h1 style={{ fontSize: '100px', fontWeight: '900', lineHeight: '1', background: 'linear-gradient(to right, #fcd34d, #f59e0b, #fcd34d)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', margin: 0 }}>WATCH<br />DONOR</h1>
                    </div>
                    <div style={{ width: '450px', height: '450px', borderRadius: '50%', border: '4px solid #d97706', padding: '10px', marginBottom: '60px', position: 'relative' }}>
                        <div style={{ width: '100%', height: '100%', borderRadius: '50%', overflow: 'hidden', backgroundColor: '#1a1a1a' }}>
                            <img src={data.photo || DEFAULT_AVATAR} style={{ width: '100%', height: '100%', objectFit: 'cover' }} crossOrigin="anonymous" />
                        </div>
                        <div style={{ position: 'absolute', bottom: '-30px', left: '50%', transform: 'translateX(-50%)', backgroundColor: '#d97706', color: 'black', padding: '10px 40px', borderRadius: '50px', fontWeight: 'bold', fontSize: '24px', border: '4px solid black', whiteSpace: 'nowrap' }}>2025 DONOR</div>
                    </div>
                    <div style={{ marginBottom: 'auto' }}>
                        <p style={{ fontFamily: 'Inter', fontSize: '32px', color: '#9ca3af', marginBottom: '20px', fontStyle: 'italic' }}>Presented to</p>
                        <h2 style={{ fontSize: '80px', fontWeight: '700', color: 'white', marginBottom: '30px', textShadow: '0 4px 20px rgba(0,0,0,0.5)' }}>{data.fullName}</h2>
                        <p style={{ fontFamily: 'Inter', fontSize: '32px', color: '#d1d5db', maxWidth: '800px', margin: '0 auto', lineHeight: '1.5' }}>
                            "For your timeless contribution of a <span style={{ color: '#fbbf24' }}>{data.watchModel || 'Timepiece'}</span> to our cause."
                        </p>
                    </div>
                    <div style={{ width: '100%', borderTop: '2px solid rgba(255,255,255,0.1)', paddingTop: '40px', display: 'flex', justifyContent: 'space-between', alignItems: 'end' }}>
                        <div style={{ textAlign: 'left' }}>
                            <div style={{ fontFamily: 'cursive', fontSize: '40px', color: '#f59e0b', marginBottom: '5px' }}>Pledge Foundation</div>
                            <div style={{ fontFamily: 'Inter', fontSize: '20px', letterSpacing: '2px', color: '#6b7280', textTransform: 'uppercase' }}>Organizer</div>
                        </div>
                        <div style={{ textAlign: 'right' }}>
                            <div style={{ fontFamily: 'Inter', fontSize: '24px', fontWeight: 'bold', color: '#f59e0b' }}>WATCH DONATION DRIVE</div>
                            <div style={{ fontFamily: 'Inter', fontSize: '20px', color: '#6b7280' }}>CHENNAI ‚Ä¢ 2025</div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // 2. Landing Page
        const Hero = ({ onStart }) => (
            <section className="min-h-screen flex flex-col justify-center items-center text-center px-4 relative overflow-hidden">
                <div className="absolute top-[-10%] right-[-10%] w-[500px] h-[500px] bg-amber-600/20 rounded-full blur-[100px] pointer-events-none" />
                <h1 className="text-5xl md:text-7xl font-playfair font-black mb-10 leading-tight relative z-10">
                    Gift A Watch,<br /><span className="text-transparent bg-clip-text bg-gradient-to-r from-amber-200 to-amber-500">Gift A Future.</span>
                </h1>
                <button
                    onClick={onStart}
                    className="btn-active relative z-20 px-10 py-5 bg-gradient-to-r from-amber-600 to-amber-500 rounded-full font-bold text-black shadow-lg shadow-amber-500/20 text-lg"
                >
                    Generate My Certificate ‚Üí
                </button>
            </section>
        );

        // 3. Form Page
        const Form = ({ onSubmit, onBack, initialData }) => {
            const [data, setData] = useState(initialData);
            const [error, setError] = useState('');
            const fileRef = useRef();

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!data.fullName.trim() || !data.phone.trim()) {
                    setError('Name and Phone are required');
                    return;
                }
                onSubmit(data);
            };

            return (
                <section className="min-h-screen flex items-center justify-center px-4 py-8 animate-fade-in relative z-10">
                    <div className="w-full max-w-xl bg-[#0f0f12] border border-white/10 p-6 md:p-8 rounded-3xl shadow-2xl">
                        <h2 className="text-3xl font-playfair font-bold text-center mb-6">Donor Details</h2>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="flex flex-col items-center mb-6">
                                <div onClick={() => fileRef.current.click()} className={`w-36 h-36 rounded-full border-2 border-dashed flex items-center justify-center cursor-pointer relative overflow-hidden btn-active ${data.photo ? 'border-amber-500' : 'border-gray-600'}`}>
                                    {data.photo ? <img src={data.photo} className="w-full h-full object-cover" /> : <span className="text-4xl">üì∏</span>}
                                </div>
                                <input ref={fileRef} type="file" className="hidden" accept="image/*" onChange={e => {
                                    if (e.target.files[0]) {
                                        const r = new FileReader();
                                        r.onload = () => setData({ ...data, photo: r.result });
                                        r.readAsDataURL(e.target.files[0]);
                                    }
                                }} />
                                <p className="text-xs text-gray-500 mt-2">Tap circle to upload photo</p>
                            </div>

                            <input required type="text" value={data.fullName} onChange={e => setData({ ...data, fullName: e.target.value })} placeholder="Full Name" className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-4 outline-none focus:border-amber-500 text-white" />
                            <input required type="tel" value={data.phone} onChange={e => setData({ ...data, phone: e.target.value })} placeholder="Phone Number" className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-4 outline-none focus:border-amber-500 text-white" />
                            <input type="text" value={data.watchModel || ''} onChange={e => setData({ ...data, watchModel: e.target.value })} placeholder="Watch Model (Optional)" className="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-4 outline-none focus:border-amber-500 text-white" />

                            {error && <p className="text-red-500 text-sm text-center">{error}</p>}

                            <div className="flex gap-4 pt-4">
                                <button type="button" onClick={onBack} className="btn-active flex-1 py-4 text-gray-400 font-medium hover:text-white border border-white/10 rounded-xl">Back</button>
                                <button type="submit" className="btn-active flex-[2] py-4 bg-amber-600 text-black font-bold rounded-xl shadow-lg">Next ‚Üí</button>
                            </div>
                        </form>
                    </div>
                </section>
            );
        };

        // 4. Preview
        const Preview = ({ data, onEdit, onFinalize }) => (
            <section className="min-h-screen py-10 px-4 flex flex-col items-center animate-fade-in text-center z-10 relative">
                <h2 className="text-3xl font-playfair font-bold text-white mb-2">Preview Draft</h2>
                <div className="relative w-full max-w-[300px] aspect-[3/4] bg-gray-900 rounded-xl overflow-hidden shadow-2xl mb-8 border border-white/10">
                    <div className="absolute inset-0 flex items-center justify-center">
                        <div className="transform scale-[0.28] origin-top-left absolute top-0 left-0 pointer-events-none"><Poster data={data} /></div>
                    </div>
                </div>
                <div className="flex flex-col w-full max-w-sm gap-4">
                    <button onClick={onFinalize} className="btn-active w-full py-4 bg-gradient-to-r from-amber-600 to-amber-500 text-black font-bold rounded-xl shadow-lg">
                        Finalize & Download
                    </button>
                    <button onClick={onEdit} className="btn-active w-full py-4 bg-white/10 text-white font-medium rounded-xl">
                        Edit Details
                    </button>
                </div>
            </section>
        );

        // 5. Success
        const Success = ({ data, onReset }) => {
            const posterRef = useRef();
            const [img, setImg] = useState(null);
            const [file, setFile] = useState(null);

            useEffect(() => {
                const gen = async () => {
                    await new Promise(r => setTimeout(r, 800)); // Ensure DOM is ready
                    if (posterRef.current) {
                        try {
                            // Generate with local settings to avoid CORS
                            const canvas = await html2canvas(posterRef.current, { scale: 2, useCORS: true, backgroundColor: '#050505' });
                            const url = canvas.toDataURL('image/png');
                            setImg(url);
                            canvas.toBlob(b => setFile(new File([b], 'Certificate.png', { type: 'image/png' })));
                        } catch (e) { console.error(e); }
                    }
                };
                gen();
            }, []);

            const download = () => { if (img) { const a = document.createElement('a'); a.href = img; a.download = `Certificate-${data.fullName}.png`; a.click(); } };
            const share = async () => { if (file && navigator.share) { try { await navigator.share({ files: [file] }); } catch (e) { } } else { download(); } };
            const openWa = () => window.open('https://wa.me/919940142349?text=Hi, I want to donate a watch', '_blank');
            const openInsta = () => window.open('https://instagram.com/pledge_foundation/', '_blank');

            return (
                <section className="min-h-screen py-10 px-4 flex flex-col items-center animate-fade-in text-center overflow-x-hidden">
                    <div style={{ position: 'absolute', top: 0, left: '-9999px' }}><div ref={posterRef}><Poster data={data} /></div></div>

                    <h2 className="text-3xl font-playfair font-bold text-white mb-2">Certificate Ready!</h2>

                    <div className="p-2 border border-white/10 bg-white/5 rounded-xl mb-8 shadow-2xl mt-4">
                        {img ? <img src={img} className="max-w-[250px] rounded-lg" /> : <div className="w-[250px] h-[350px] flex items-center justify-center text-amber-500">Generating...</div>}
                    </div>

                    <div className="flex gap-4 w-full max-w-sm mb-10">
                        <button onClick={download} disabled={!img} className="btn-active flex-1 py-4 bg-white text-black font-bold rounded-xl shadow-lg disabled:opacity-50">Download</button>
                        <button onClick={share} disabled={!img} className="btn-active flex-1 py-4 bg-[#25D366] text-white font-bold rounded-xl shadow-lg disabled:opacity-50">Share</button>
                    </div>

                    <div className="w-full max-w-md border-t border-white/10 pt-8 grid grid-cols-2 gap-4">
                        <button onClick={openWa} className="btn-active flex flex-col items-center p-4 bg-white/5 rounded-2xl hover:bg-white/10 text-left">
                            <div className="text-2xl mb-2">üï∞Ô∏è</div>
                            <div className="text-amber-500 font-bold text-xs uppercase">Donate Watch</div>
                        </button>
                        <button onClick={openInsta} className="btn-active flex flex-col items-center p-4 bg-white/5 rounded-2xl hover:bg-white/10 text-left">
                            <div className="text-2xl mb-2">‚ù§Ô∏è</div>
                            <div className="text-pink-500 font-bold text-xs uppercase">Follow Us</div>
                        </button>
                    </div>

                    <button onClick={onReset} className="mt-8 text-gray-500 text-sm py-4">Create New</button>
                </section>
            );
        };

        const App = () => {
            const [step, setStep] = useState(STEPS.HERO);
            const [data, setData] = useState({ fullName: '', email: '', phone: '', photo: null });
            return (
                <div className="min-h-screen w-full relative">
                    {step === STEPS.HERO && <Hero onStart={() => setStep(STEPS.FORM)} />}
                    {step === STEPS.FORM && <Form initialData={data} onSubmit={d => { setData(d); setStep(STEPS.PREVIEW) }} onBack={() => setStep(STEPS.HERO)} />}
                    {step === STEPS.PREVIEW && <Preview data={data} onEdit={() => setStep(STEPS.FORM)} onFinalize={() => setStep(STEPS.SUCCESS)} />}
                    {step === STEPS.SUCCESS && <Success data={data} onReset={() => { setData({ fullName: '', email: '', phone: '', photo: null }); setStep(STEPS.HERO) }} />}
                </div>
            );
        };
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>

</html>