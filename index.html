<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>PureShores | Restore. Revive. Renew.</title>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- HTML2Canvas & jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Cropper.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#0EA5E9", // Sky blue brand color
                        secondary: "#F97316", // Orange accent
                        "background-light": "#F0F9FF", // Very light blue tint
                        "background-dark": "#0F172A", // Dark slate
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#1E293B",
                        "text-main-light": "#1E293B",
                        "text-main-dark": "#F1F5F9",
                        "text-muted-light": "#64748B",
                        "text-muted-dark": "#94A3B8",
                    },
                    fontFamily: {
                        display: ['"DM Serif Display"', 'serif'],
                        sans: ['"Inter"', 'sans-serif'],
                    },
                    borderRadius: {
                        DEFAULT: "0.375rem",
                    },
                    animation: {
                        "fade-in-up": "fadeInUp 0.5s ease-out forwards",
                    },
                    keyframes: {
                        fadeInUp: {
                            "0%": { opacity: "0", transform: "translateY(20px)" },
                            "100%": { opacity: "1", transform: "translateY(0)" },
                        },
                    }
                },
            },
        };
    </script>
    <style>
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeInUp 0.5s ease-out forwards;
        }

        /* Cropper Overrides for Light Theme */
        .cropper-view-box,
        .cropper-face {
            border-radius: 50%;
        }

        .cropper-view-box {
            outline: 2px solid #0EA5E9;
            box-shadow: 0 0 0 1px #0EA5E9;
        }

        /* Loader */
        .loader {
            width: 48px;
            height: 48px;
            border: 3px solid #0EA5E9;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-text-main-light dark:text-text-main-dark font-sans selection:bg-primary selection:text-white transition-colors duration-300">

    <!-- Header (Shared) -->
    <header
        class="sticky top-0 z-50 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-sm border-b border-slate-200 dark:border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Left Side Communitree Logo -->
                <div class="flex items-center">
                    <img src="Communitree New Logo Green (1).png" alt="Communitree Logo" class="h-20 w-auto" />
                </div>

                <!-- Right Side Ample Logo -->
                <div class="flex items-center cursor-pointer" onclick="goToStep('landing')">
                    <img src="logo.svg" alt="Company Logo" class="h-10 w-auto" />
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- STEP 1: LANDING PAGE -->
        <div id="step-landing" class="step active">
            <section class="relative h-[800px] flex items-center overflow-hidden">
                <div class="absolute inset-0 z-0">
                    <img alt="Beautiful turquoise ocean waves crashing on a sandy beach"
                        class="w-full h-full object-cover"
                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuBOtE7p3kgBPZiAWANBygqmTB-2y98TJhGXVOIEL_4eCb7Ki0_p9Vlw3gk2dg2p_mcQGxEP-lQGSTQsiW_1GXMsLoWTu6axNhd0wyFjZINgo1oXfP2c-byrDIg4HqgdUnj0ZeuszVM1LCGW4aAtJDJN9WI6vKldgl2d17m6n38unFTQEFvOQk7XCEBBHsfL1kEeDZ9Mj5-tq7g7bWEJEAyTkdWm8uBNWAf52v2fWGhbNXBVYg15T1skzR9UdkCDxsDmxFWcYlF5XFs" />
                    <div
                        class="absolute inset-0 bg-gradient-to-r from-slate-900/60 to-slate-900/10 dark:from-black/70 dark:to-black/30">
                    </div>
                </div>
                <!-- Communitree Logo removed from here -->
                <!-- Dynamic Content Container -->
                <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full pt-12">
                    <h1 class="font-display text-5xl md:text-6xl lg:text-7xl text-white leading-tight mb-6">
                        Thank You for Taking Responsibility for Our Beaches
                    </h1>
                    <div class="flex items-start mb-10 max-w-2xl">
                        <div class="w-1 h-16 bg-secondary mr-6 mt-1 flex-shrink-0"></div>
                        <p class="text-lg md:text-xl text-slate-100 font-light leading-relaxed">
                            Every small action matters.
                            By showing up for the beach cleanup, you helped protect marine life, preserve coastlines,
                            and inspire others to care.
                        </p>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <!-- Triggers form step -->
                        <button onclick="goToStep('form')"
                            class="inline-flex justify-center items-center bg-primary hover:bg-sky-600 text-white px-8 py-3.5 rounded font-bold transition-all shadow-lg shadow-sky-500/30">
                            <span class="material-icons-outlined text-sm mr-2">download</span>
                            Download Your Certificate
                        </button>
                    </div>
                </div>
            </section>

            <!-- PureShores Content -->
            <section class="relative z-20 mt-8 lg:mt-12 pb-12 lg:pb-24">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative">
                    <div class="bg-slate-900 rounded-[2rem] shadow-2xl overflow-hidden border border-slate-700/50">
                        <div class="grid grid-cols-1 lg:grid-cols-2">
                            <!-- Left Side: Main Feature -->
                            <div class="relative p-12 lg:p-16 flex flex-col justify-center min-h-[500px]">
                                <div class="absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900 opacity-90">
                                </div>
                                <div
                                    class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/washi.png')] opacity-10 pointer-events-none mix-blend-overlay">
                                </div>

                                <!-- Dynamic Main Content -->
                                <div id="metric-main-container"
                                    class="relative z-10 transition-all duration-700 ease-in-out">
                                    <span id="metric-main-tag"
                                        class="text-secondary font-bold tracking-widest uppercase text-sm mb-4 block">Our
                                        Community</span>
                                    <h3 id="metric-main-title" class="text-3xl md:text-4xl font-medium text-white mb-8">
                                        Volunteers Mobilized</h3>
                                    <div class="flex items-baseline gap-4 mb-8">
                                        <span id="metric-main-value"
                                            class="font-display text-7xl md:text-8xl font-bold text-white tracking-tight">107k+</span>
                                        <span id="metric-main-unit"
                                            class="text-primary text-5xl md:text-6xl material-icons-outlined transform translate-y-2">people</span>
                                    </div>
                                    <p id="metric-main-desc"
                                        class="text-lg text-slate-400 mb-10 max-w-md leading-relaxed">
                                        Join over 100,000 volunteers making a visible difference. Together, we are a
                                        force for change.
                                    </p>
                                    <a class="inline-flex items-center justify-center bg-white text-slate-900 px-8 py-4 rounded-full font-bold text-lg hover:bg-slate-200 transition-colors duration-300 w-fit group"
                                        href="#">
                                        Become a Volunteer
                                        <span
                                            class="material-icons-outlined ml-2 group-hover:translate-x-1 transition-transform">arrow_forward</span>
                                    </a>
                                </div>
                            </div>

                            <!-- Right Side: List -->
                            <div
                                class="relative p-12 lg:p-16 flex items-center bg-slate-800/50 border-t lg:border-t-0 lg:border-l border-slate-700/50 min-h-[500px]">
                                <div
                                    class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5 pointer-events-none">
                                </div>
                                <div
                                    class="relative w-full backdrop-blur-xl bg-white/5 border border-white/10 rounded-3xl p-8 lg:p-10 shadow-xl overflow-hidden">
                                    <div class="absolute top-0 right-0 p-6 opacity-20 pointer-events-none">
                                        <span id="metric-bg-icon"
                                            class="material-icons-outlined text-8xl text-primary rotate-12 transition-all duration-700">public</span>
                                    </div>
                                    <!-- Dynamic List Content -->
                                    <div id="metric-list-container" class="relative z-10 space-y-10">
                                        <!-- List items will be injected here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="py-20 lg:py-32 bg-background-light dark:bg-background-dark">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                        <div>
                            <h2 class="font-display text-5xl lg:text-6xl text-slate-900 dark:text-white leading-tight">
                                Making a visible<br />
                                <span class="relative inline-block">
                                    <span class="relative z-10 text-primary">difference.</span>
                                </span>
                            </h2>
                        </div>
                        <div>
                            <p class="text-lg text-slate-600 dark:text-slate-300 leading-relaxed mb-8">
                                We believe in transparency and the power of collective action. Every cleanup is
                                documented, verified, and added to our global database.
                            </p>
                            <a class="inline-flex items-center text-primary font-bold text-sm tracking-wide hover:text-sky-600 transition-colors uppercase"
                                href="#">
                                Read full impact report
                                <span class="material-icons-outlined ml-2 text-lg">arrow_forward</span>
                            </a>
                        </div>
                    </div>
                </div>
            </section>
            <section class="py-12 pb-24 bg-background-light dark:bg-background-dark overflow-hidden">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-10 flex justify-between items-end">
                    <h2 class="font-display text-4xl text-slate-900 dark:text-white">Explore Initiatives</h2>
                    <div class="flex gap-2">
                        <button
                            class="w-10 h-10 rounded-full border border-slate-200 dark:border-slate-700 flex items-center justify-center hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-600 dark:text-slate-300">
                            <span class="material-icons-outlined text-sm">arrow_back_ios_new</span>
                        </button>
                        <button
                            class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center hover:bg-sky-600 transition-colors shadow-lg shadow-sky-500/20">
                            <span class="material-icons-outlined text-sm">arrow_forward_ios</span>
                        </button>
                    </div>
                </div>
                <!-- ... Images ... -->
                <div class="pl-4 sm:pl-6 lg:pl-8 overflow-x-auto no-scrollbar pb-8">
                    <div class="flex gap-6 w-max pr-8">
                        <div
                            class="relative w-[300px] md:w-[600px] h-[500px] rounded-[32px] overflow-hidden group cursor-pointer shadow-xl transition-all hover:scale-[1.01]">
                            <img alt="Turtle crawling on sand"
                                class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuCxb68n_7NnOpptwRnBpPPHeOUF6bxGKKq-gGfFjpq7QR9H4wBWSMlhiu4gGg9cDhqbiUGebMI6lDMoIhRxVbSV-iHqeZmaA7Ckc9AFc7eiOfeihL92XmlUs4pdUwhiNWLG-T-r1OmVPDzubNLIAqMR-o0xXCgIGMn-i9shgYVGEffWrizRYzIGqm7p03Q4R3VkQ9EDLndqwr480v9_3KwdjVdcV49YjMaTNwM6mJpLCHApPI8J11TxDYBDQFpPcbCHntBYS54-56k" />
                            <div
                                class="absolute inset-0 bg-gradient-to-t from-slate-900/90 via-slate-900/40 to-transparent">
                            </div>
                            <div class="absolute inset-0 flex flex-col justify-end p-10 md:p-12">
                                <h3 class="font-display text-5xl md:text-6xl text-white mb-6 leading-tight">
                                    <span class="border-b-4 border-secondary/80 pb-1">Turtle</span> Walks
                                </h3>
                                <p class="text-slate-200 text-lg md:text-xl font-medium mb-8 max-w-sm leading-relaxed">
                                    Helping protect nesting grounds and ensuring safe paths for turtles during critical
                                    periods.
                                </p>
                                <button
                                    class="w-fit bg-primary hover:bg-sky-500 text-slate-900 font-bold px-8 py-3.5 rounded-full transition-all transform hover:-translate-y-1 flex items-center gap-2 group-hover:bg-white group-hover:text-slate-900">
                                    Join the cause
                                    <span class="material-icons-outlined text-xl">arrow_forward</span>
                                </button>
                            </div>
                        </div>
                        <div
                            class="relative w-[300px] md:w-[600px] h-[500px] rounded-[32px] overflow-hidden group cursor-pointer shadow-xl transition-all hover:scale-[1.01]">
                            <img alt="Volunteer cleaning beach"
                                class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuAgSq-eITFpaOllgmH7IWi7kZM0KZrZefrbl3FLKmkoqBC8N61ap1d8XQH7VLZPFxitA4g7iZO2q8MfNoNjKdAafAiFIzUW-b1zMQZ1K5v6i3xgvMJpuR9gGlP2xGhVDXVYdTkBf9sZdMP_V2Co-742YaWiIEL0PbQgbECEbNf6gpHuODvGk99GUtaqpA5FhHwEeiq2B5OTpSbgzDR3mDBW41HHsx18VojOX2Q_y0buYQNCl7hgtWez4x9urYdTitwJ0AT1RQ-xFCQ" />
                            <div
                                class="absolute inset-0 bg-gradient-to-t from-slate-900/90 via-slate-900/40 to-transparent">
                            </div>
                            <div class="absolute inset-0 flex flex-col justify-end p-10 md:p-12">
                                <h3 class="font-display text-5xl md:text-6xl text-white mb-6 leading-tight">
                                    Beach <span class="border-b-4 border-primary/80 pb-1">Cleanup</span> Drives
                                </h3>
                                <p class="text-slate-200 text-lg md:text-xl font-medium mb-8 max-w-sm leading-relaxed">
                                    Removing plastic, waste, and harmful materials from shorelines to protect marine
                                    ecosystems.
                                </p>
                                <button
                                    class="w-fit border-2 border-white/40 hover:bg-white hover:border-white hover:text-slate-900 text-white font-bold px-8 py-3.5 rounded-full transition-all transform hover:-translate-y-1 flex items-center gap-2">
                                    Get involved
                                    <span class="material-icons-outlined text-xl">arrow_forward</span>
                                </button>
                            </div>
                        </div>
                        <div
                            class="relative w-[300px] md:w-[600px] h-[500px] rounded-[32px] overflow-hidden group cursor-pointer shadow-xl transition-all hover:scale-[1.01]">
                            <img alt="Intricate sand sculpture"
                                class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuD__QuVQUXkMHh5URPJebjXMEvTcb4G_iMTjMvmvrx1OzJsjS54cI93Y8vt9C9c6NFPOv8dsPj99shaXZawb63OMeofzdGdOXr_CXHQ90AGsqgspJFlNz3mQxUT1e2nbxLr6HE1B539Mro8YlQh_l2kJT9VgJrde3YNKO2JrB0DAgV4fTch91spXXk0Um074tCWcybDQNjp5AxzdK7gWDWS4sBd-CZSddT1iQDwuWk5hQOZV-l1BL_5nj4efe0Hd1qLkur_fBhgy7o" />
                            <div
                                class="absolute inset-0 bg-gradient-to-t from-slate-900/90 via-slate-900/40 to-transparent">
                            </div>
                            <div class="absolute inset-0 flex flex-col justify-end p-10 md:p-12">
                                <h3 class="font-display text-3xl md:text-4xl text-white mb-6 leading-tight">
                                    Waste Collection & <span
                                        class="border-b-4 border-purple-500/80 pb-1">Segregation</span>
                                </h3>
                                <p class="text-slate-200 text-lg md:text-xl font-medium mb-8 max-w-sm leading-relaxed">
                                    Collecting and responsibly handling waste so it doesn’t return to the ocean.
                                </p>
                                <button
                                    class="w-fit border-2 border-white/40 hover:bg-white hover:border-white hover:text-slate-900 text-white font-bold px-8 py-3.5 rounded-full transition-all transform hover:-translate-y-1 flex items-center gap-2">
                                    View events
                                    <span class="material-icons-outlined text-xl">arrow_forward</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- STEP 2: FORM (RESTORED AS SEPARATE STEP) -->
        <div id="step-form" class="step">
            <div class="w-full py-20 min-h-screen flex items-center justify-center bg-background-light">
                <!-- PureShores Form Card -->
                <div class="max-w-2xl w-full mx-4">
                    <div
                        class="bg-surface-light rounded-[2rem] shadow-2xl overflow-hidden border border-slate-200 z-10 relative">
                        <div class="p-8 md:p-12">
                            <div class="text-center mb-10">
                                <span class="text-secondary font-bold tracking-widest uppercase text-sm mb-2 block">Take
                                    Action</span>
                                <h2 class="font-display text-4xl text-slate-800 mb-4">Create Your Certificate</h2>
                                <p class="text-slate-600">Personalize your pledge to protect our shores.</p>
                            </div>

                            <form id="detailsForm" onsubmit="handleFormSubmit(event)" class="space-y-6">
                                <!-- Photo Upload -->
                                <div class="flex flex-col items-center gap-6">
                                    <div class="relative group cursor-pointer"
                                        onclick="document.getElementById('photoInput').click()">
                                        <div
                                            class="w-32 h-32 rounded-full border-4 border-slate-100 flex items-center justify-center overflow-hidden bg-slate-50 group-hover:border-primary transition-all duration-300 shadow-lg">
                                            <img id="photoPreview" class="hidden w-full h-full object-cover" />
                                            <div id="photoPlaceholder" class="text-center p-2">
                                                <span
                                                    class="material-icons-outlined text-3xl text-slate-400 mb-1 group-hover:text-primary transition-colors">add_a_photo</span>
                                            </div>
                                        </div>
                                        <div
                                            class="absolute -bottom-2 -right-2 w-10 h-10 bg-primary rounded-full flex items-center justify-center shadow-lg transform transition-transform group-hover:scale-110">
                                            <span class="material-icons-outlined text-white text-lg">edit</span>
                                        </div>
                                    </div>
                                    <div class="flex gap-4">
                                        <button type="button" onclick="document.getElementById('photoInput').click()"
                                            class="text-sm font-bold text-primary hover:text-sky-600 tracking-wide uppercase">
                                            Upload Photo
                                        </button>
                                        <span class="text-slate-300">|</span>
                                        <button type="button" onclick="openCameraModal()"
                                            class="text-sm font-bold text-primary hover:text-sky-600 tracking-wide uppercase">
                                            Use Camera
                                        </button>
                                    </div>
                                    <input type="file" id="photoInput" accept="image/png, image/jpeg" class="hidden"
                                        onchange="handleFileSelect(event)" />
                                </div>

                                <div class="space-y-5">
                                    <div>
                                        <label
                                            class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 ml-1">Full
                                            Name</label>
                                        <input id="fullName" required type="text" placeholder="e.g. Jane Doe"
                                            class="w-full px-5 py-4 rounded-xl border border-slate-200 bg-slate-50 text-slate-800 placeholder-slate-400 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" />
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                        <div>
                                            <label
                                                class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 ml-1">WhatsApp</label>
                                            <div
                                                class="flex rounded-xl border border-slate-200 bg-slate-50 overflow-hidden focus-within:border-primary focus-within:ring-1 focus-within:ring-primary transition-all">
                                                <div class="w-[30%] border-r border-slate-200 bg-slate-100 relative">
                                                    <select id="countryCode"
                                                        class="w-full h-full bg-transparent border-none text-slate-700 text-sm font-medium text-center appearance-none focus:ring-0 cursor-pointer pl-2 pr-6 py-4">
                                                        <option value="+91">+91</option>
                                                    </select>
                                                    <span
                                                        class="absolute right-1 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400">
                                                        <span class="material-icons-outlined text-sm">expand_more</span>
                                                    </span>
                                                </div>
                                                <input id="phone" required type="tel" placeholder="98765 43210"
                                                    class="w-[70%] bg-transparent border-none text-slate-800 placeholder-slate-400 focus:ring-0 px-4 py-4" />
                                            </div>
                                        </div>

                                        <div>
                                            <label
                                                class="block text-xs font-bold text-slate-500 uppercase tracking-widest mb-2 ml-1">Email</label>
                                            <input id="email" required type="email" placeholder="name@example.com"
                                                class="w-full px-5 py-4 rounded-xl border border-slate-200 bg-slate-50 text-slate-800 placeholder-slate-400 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" />
                                        </div>
                                    </div>
                                </div>

                                <!-- Checkboxes -->
                                <div class="space-y-4 pt-2">
                                    <label class="flex items-start gap-4 cursor-pointer group">
                                        <div class="relative flex items-center h-5">
                                            <input id="marketingCheckbox" type="checkbox"
                                                class="h-5 w-5 rounded border-slate-300 text-primary focus:ring-primary cursor-pointer" />
                                        </div>
                                        <span class="text-sm text-slate-600">I agree to receive updates about the
                                            campaign.</span>
                                    </label>
                                    <label class="flex items-start gap-4 cursor-pointer group">
                                        <div class="relative flex items-center h-5">
                                            <input id="consentCheckbox" required type="checkbox"
                                                class="h-5 w-5 rounded border-slate-300 text-primary focus:ring-primary cursor-pointer" />
                                        </div>
                                        <div class="text-sm text-slate-600">
                                            <span>I agree to the processing of my data. </span>
                                            <a href="privacy-policy.html" target="_blank"
                                                class="text-primary hover:text-sky-600 underline">Privacy Policy</a>
                                        </div>
                                    </label>
                                </div>
                                <!-- Hidden Honeypot -->
                                <div class="opacity-0 absolute -z-50 pointer-events-none">
                                    <input type="text" id="website_field" name="website" tabindex="-1"
                                        autocomplete="off">
                                </div>

                                <!-- Actions -->
                                <!-- Added Cancel button to return to home -->
                                <div class="flex gap-4">
                                    <button type="button" onclick="goToStep('landing')"
                                        class="w-1/3 px-6 py-4 rounded-xl border border-slate-200 text-slate-500 font-bold hover:bg-slate-50 transition-colors">
                                        BACK
                                    </button>
                                    <button type="submit"
                                        class="w-2/3 px-6 py-4 rounded-xl bg-primary hover:bg-sky-600 text-white font-bold tracking-wide shadow-lg shadow-sky-500/20 transition-all transform hover:-translate-y-1">
                                        PREVIEW CERTIFICATE
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 3: PREVIEW -->
        <div id="step-preview" class="step">
            <div class="w-full py-20 min-h-screen flex items-center justify-center bg-background-light">
                <div class="max-w-2xl w-full mx-4 flex flex-col items-center">
                    <div class="text-center mb-10">
                        <h2 class="font-display text-4xl text-slate-800 mb-2">Preview Certificate</h2>
                        <p class="text-slate-600">One last look before you save it.</p>
                    </div>

                    <!-- Canvas -->
                    <div id="certificate-wrapper"
                        class="relative w-full max-w-sm mx-auto mb-10 rounded-xl overflow-hidden shadow-2xl border border-slate-200 bg-white transform transition-transform hover:scale-[1.01]">
                        <div id="certificate-visual"
                            class="relative w-full aspect-[3/4.2] bg-white overflow-hidden text-gray-900">
                            <img src="poster_bg.png" class="absolute inset-0 w-full h-full object-cover"
                                alt="Certificate Background">
                            <div class="absolute inset-0 z-10 w-full h-full">
                                <!-- Photo Adjusted to match new design -->
                                <div
                                    class="absolute top-[30%] left-[8%] w-[32%] aspect-square rounded-full overflow-hidden bg-black/10">
                                    <img id="cert-user-photo" src="" class="w-full h-full object-cover"
                                        alt="Donor Photo">
                                </div>
                                <!-- Name Adjusted to be below photo -->
                                <div class="absolute top-[54%] left-[8%] w-[80%] text-left flex items-center h-auto">
                                    <h2
                                        class="text-lg font-sans font-bold text-[#000] tracking-wide leading-none select-none">
                                        <span id="cert-user-name">Jane Doe</span>
                                    </h2>
                                </div>
                                <div id="cert-id" class="hidden"></div>
                                <div id="cert-date" class="hidden"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="flex gap-4 w-full">
                        <button onclick="goToStep('form')"
                            class="flex-1 px-8 py-4 rounded-xl border border-slate-200 text-slate-500 font-bold hover:bg-slate-50 transition-all">
                            EDIT
                        </button>
                        <button onclick="finalizeCertificate()"
                            class="flex-1 px-8 py-4 rounded-xl bg-primary hover:bg-sky-600 text-white font-bold tracking-wide shadow-lg shadow-sky-500/20 transition-all transform hover:-translate-y-1">
                            GET CERTIFICATE
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 4: SUCCESS -->
        <div id="step-success" class="step">
            <div class="w-full py-20 min-h-screen flex items-center justify-center bg-background-light">
                <div class="max-w-3xl w-full mx-4 flex flex-col items-center text-center">
                    <div class="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center mb-8">
                        <span class="material-icons-outlined text-green-600 text-5xl">check_circle</span>
                    </div>
                    <h2 class="font-display text-5xl text-slate-800 mb-4">Thank You!</h2>
                    <p class="text-xl text-slate-600 mb-12 max-w-lg">
                        Your certificate is ready. Together, we are making waves for a cleaner future.
                    </p>

                    <!-- Final Cert Container -->
                    <div id="final-cert-container"
                        class="w-full max-w-sm mb-12 shadow-2xl rounded-xl overflow-hidden border border-slate-200">
                        <!-- JS Moves Node Here -->
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4 w-full max-w-md">
                        <button onclick="downloadPDF()"
                            class="flex-1 px-8 py-4 rounded-xl bg-primary hover:bg-sky-600 text-white font-bold shadow-lg shadow-sky-500/20 transition-all flex items-center justify-center gap-2">
                            <span class="material-icons-outlined">download</span>
                            Download
                        </button>
                        <button onclick="shareImpact()"
                            class="flex-1 px-8 py-4 rounded-xl border-2 border-slate-200 hover:border-primary hover:text-primary text-slate-600 font-bold transition-all flex items-center justify-center gap-2">
                            <span class="material-icons-outlined">share</span>
                            Share
                        </button>
                    </div>

                    <button onclick="resetApp()"
                        class="mt-12 text-slate-400 hover:text-primary transition-colors flex items-center gap-2 text-sm uppercase tracking-widest font-bold">
                        <span class="material-icons-outlined text-lg">replay</span>
                        Create Another
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-slate-50 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 pt-20 pb-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-12 lg:gap-8 mb-16">
                <div class="lg:col-span-2">
                    <div class="flex items-center mb-6">
                        <img src="ngo_logo.jpg" alt="Communitree Logo" class="h-10 w-auto" />
                    </div>
                    <p class="text-slate-500 dark:text-slate-400 text-sm leading-relaxed mb-6 max-w-sm">
                        Restoring the ocean's natural beauty through innovation, community, and persistent action. Join
                        over 500 active projects worldwide.
                    </p>
                    <div class="flex space-x-4">
                        <!-- LinkedIn -->
                        <a href="https://www.linkedin.com/company/communitree-india/?originalSubdomain=in"
                            target="_blank"
                            class="w-10 h-10 rounded bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary hover:border-primary dark:hover:border-primary transition-all">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path
                                    d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                            </svg>
                        </a>
                        <!-- Instagram -->
                        <a href="https://www.instagram.com/communitreeindia/" target="_blank"
                            class="w-10 h-10 rounded bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center text-slate-500 dark:text-slate-400 hover:text-pink-600 dark:hover:text-pink-500 hover:border-pink-600 dark:hover:border-pink-500 transition-all">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path fill-rule="evenodd"
                                    d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 014.121 3.3c.636-.247 1.363-.416 2.427-.465C7.502 2.088 7.86 2 12.315 2zM12.05 4.954h-.053c-4.49 0-4.708.016-5.83.066-.78.035-1.205.16-1.487.27a2.91 2.91 0 00-1.045.679 2.91 2.91 0 00-.679 1.045c-.11.282-.236.707-.27 1.487-.05 1.122-.066 1.259-.066 5.67s.016 4.548.066 5.67c.034.78.16 1.205.27 1.487.235.603.54 1.127.994 1.58.453.454.977.759 1.58.995.282.11.707.236 1.487.27 1.122.05 1.259.066 5.67.066s4.548-.016 5.67-.066c.78-.035 1.205-.16 1.487-.27.603-.236 1.127-.541 1.58-.995.454-.453.759-.977.995-1.58.11-.282.236-.707.27-1.487.05-1.122.066-1.259.066-5.67s-.016-4.548-.066-5.67c-.035-.78-.16-1.205-.27-1.487a2.91 2.91 0 00-.679-1.045 2.91 2.91 0 00-1.045-.679c-.282-.11-.707-.236-1.487-.27-1.122-.05-1.259-.066-5.67-.066zM12.308 6.946c2.97 0 5.378 2.395 5.378 5.378s-2.395 5.365-5.378 5.365a5.377 5.377 0 01-5.365-5.365c0-2.983 2.395-5.378 5.365-5.378zm0 2.217a3.161 3.161 0 00-3.148 3.16 3.16 3.16 0 003.148 3.149 3.161 3.161 0 003.148-3.149 3.161 3.161 0 00-3.148-3.16zM17.336 6.93a1.476 1.476 0 101.476 1.476 1.477 1.477 0 00-1.476-1.476z"
                                    clip-rule="evenodd" />
                            </svg>
                        </a>
                        <!-- X (Twitter) -->
                        <a href="https://x.com/TreeCommuni" target="_blank"
                            class="w-10 h-10 rounded bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:border-slate-900 dark:hover:border-white transition-all">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path
                                    d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                            </svg>
                        </a>
                        <!-- Facebook -->
                        <a href="https://www.facebook.com/communitree.co.in/" target="_blank"
                            class="w-10 h-10 rounded bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center text-slate-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-500 hover:border-blue-600 dark:hover:border-blue-500 transition-all">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path fill-rule="evenodd"
                                    d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"
                                    clip-rule="evenodd" />
                            </svg>
                        </a>
                    </div>
                </div>
                <!-- Links Columns (Static) -->
            </div>
            <div
                class="border-t border-slate-200 dark:border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="text-xs text-slate-400 dark:text-slate-500">© 2024 PureShores. All rights reserved.</p>
                <div class="flex gap-6">
                    <a class="text-xs text-slate-500 dark:text-slate-400 hover:text-primary transition-colors"
                        href="#">Privacy Policy</a>
                    <a class="text-xs text-slate-500 dark:text-slate-400 hover:text-primary transition-colors"
                        href="#">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- MODALS -->

    <!-- Camera Modal -->
    <div id="camera-modal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4">
        <div class="w-full max-w-lg bg-surface-light rounded-3xl overflow-hidden shadow-2xl flex flex-col">
            <div class="p-5 border-b border-slate-100 flex justify-between items-center">
                <h3 class="font-bold text-slate-800 flex items-center gap-2">
                    <span class="material-icons-outlined text-primary">photo_camera</span>
                    Take Photo
                </h3>
                <button onclick="closeCameraModal()" class="text-slate-400 hover:text-red-500 transition-colors">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="relative bg-black aspect-video flex items-center justify-center overflow-hidden">
                <video id="camera-feed" class="w-full h-full object-cover" autoplay playsinline></video>
            </div>
            <div class="p-6 flex justify-center bg-slate-50">
                <button onclick="capturePhoto()"
                    class="w-16 h-16 rounded-full border-4 border-primary flex items-center justify-center hover:bg-primary/10 transition-colors">
                    <div class="w-12 h-12 rounded-full bg-primary"></div>
                </button>
            </div>
        </div>
    </div>

    <!-- Cropper Modal -->
    <div id="cropper-modal"
        class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-slate-900/90 backdrop-blur-sm p-4">
        <div class="w-full max-w-2xl h-[80vh] bg-surface-light rounded-3xl overflow-hidden shadow-2xl flex flex-col">
            <div class="p-5 border-b border-slate-100 flex justify-between items-center">
                <h3 class="font-bold text-slate-800 flex items-center gap-2">
                    <span class="material-icons-outlined text-primary">crop</span>
                    Adjust Photo
                </h3>
                <button onclick="closeCropperModal()" class="text-slate-400 hover:text-red-500 transition-colors">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="flex-1 bg-slate-100 relative overflow-hidden flex items-center justify-center p-4">
                <div class="h-full w-full">
                    <img id="cropper-image" class="block max-w-full max-h-full mx-auto" />
                </div>
            </div>
            <div class="p-5 border-t border-slate-100 flex justify-end gap-4 bg-slate-50">
                <button onclick="closeCropperModal()"
                    class="px-6 py-3 rounded-xl text-slate-500 hover:bg-slate-200 font-bold transition-colors">
                    Cancel
                </button>
                <button onclick="saveCrop()"
                    class="px-8 py-3 rounded-xl bg-primary hover:bg-sky-600 text-white font-bold shadow-lg shadow-sky-500/20 transition-all">
                    Save Photo
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay"
        class="fixed inset-0 z-[100] hidden flex-col items-center justify-center bg-white/90 backdrop-blur-xl transition-all">
        <span class="loader mb-6"></span>
        <h3 id="loading-text" class="text-xl font-display font-medium text-slate-800 tracking-wide">Processing...</h3>
    </div>

    <!-- LOGIC SCRIPT (Preserved) -->
    <script>
        // --- PRELOAD ASSETS ---
        const preloadedImages = {};
        (function preloadAssets() {
            const imagesToPreload = ['poster_bg.png'];
            imagesToPreload.forEach(src => {
                const img = new Image();
                img.src = src;
                preloadedImages[src] = img;
            });
        })();

        // --- CONFIGURATION ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw7pJCl4Q5x8HhBpH8VqiOtPGUCFEVOUOAPFDLCr4U6EZlR5qXxrw81nU2EnV9qJcyT/exec";

        // --- GOOGLE SHEETS ---
        function submitToGoogleSheet() {
            if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL.includes("YOUR_")) return;

            const payload = {
                fullName: userData.fullName,
                countryCode: userData.countryCode,
                phoneNumber: userData.phoneNumber,
                phone: userData.phone,
                email: userData.email,
                privacyConsent: userData.privacyConsent,
                marketingOptIn: userData.marketingOptIn
            };

            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify(payload)
            }).then(() => { }).catch(error => { console.error("Error submitting:", error); });
        }

        // State
        let userData = {
            fullName: '', countryCode: '', phoneNumber: '', phone: '', email: '',
            privacyConsent: false, marketingOptIn: false, photo: null
        };

        // Variables
        let cropper = null;
        let activeImageSource = null;

        // Navigation
        function goToStep(stepId) {
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            const target = document.getElementById(`step-${stepId}`);
            if (target) {
                target.classList.add('active');
                window.scrollTo(0, 0);
            }
            if (stepId === 'preview') updateCertificateDOM();
        }

        // --- COUNTRIES ---
        const countriesInfo = [
            { name: "India", code: "+91" }, { name: "USA", code: "+1" }, { name: "UK", code: "+44" },
            { name: "UAE", code: "+971" }, { name: "Australia", code: "+61" }, { name: "Canada", code: "+1" }
        ];

        function initCountries() {
            const select = document.getElementById('countryCode');
            select.innerHTML = '';
            countriesInfo.forEach(country => {
                const option = document.createElement('option');
                option.value = country.code;
                option.text = `${country.code}`;
                if (country.code === "+91") option.selected = true;
                select.appendChild(option);
            });
        }

        // --- CAMERA ---
        let stream = null;
        const videoElement = document.getElementById('camera-feed');

        async function openCameraModal() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoElement.srcObject = stream;
                document.getElementById('camera-modal').classList.remove('hidden');
            } catch (err) {
                alert("Could not access camera.");
            }
        }

        function closeCameraModal() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            document.getElementById('camera-modal').classList.add('hidden');
        }

        function capturePhoto() {
            if (!stream) return;
            const canvas = document.createElement('canvas');
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(videoElement, 0, 0);
            const dataURL = canvas.toDataURL('image/jpeg');
            closeCameraModal();
            showLoading("Processing...");
            runAfterPaint(() => { hideLoading(); openCropperModal(dataURL); });
        }

        // --- CROPPER ---
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                showLoading("Analyzing...");
                runAfterPaint(() => {
                    const objectUrl = window.URL.createObjectURL(file);
                    const img = new Image();
                    img.src = objectUrl;
                    img.onload = () => {
                        hideLoading();
                        openCropperModal(objectUrl);
                    };
                });
            }
            event.target.value = '';
        }

        function openCropperModal(imageSrc) {
            const image = document.getElementById('cropper-image');
            activeImageSource = imageSrc;
            image.src = imageSrc;
            document.getElementById('cropper-modal').classList.remove('hidden');
            if (cropper) cropper.destroy();
            cropper = new Cropper(image, { aspectRatio: 1, viewMode: 1, dragMode: 'move', autoCropArea: 0.8 });
        }

        function closeCropperModal() {
            if (cropper) cropper.destroy();
            cropper = null;
            document.getElementById('cropper-modal').classList.add('hidden');
        }

        function saveCrop() {
            if (!cropper) return;
            showLoading("Saving crop...");
            runAfterPaint(() => {
                const canvas = cropper.getCroppedCanvas({ width: 1080, height: 1080 });
                userData.photo = canvas.toDataURL('image/jpeg', 1.0);
                hideLoading();
                updatePhotoPreviews();
                closeCropperModal();
            });
        }

        function updatePhotoPreviews() {
            document.getElementById('photoPreview').src = userData.photo;
            document.getElementById('photoPreview').classList.remove('hidden');
            document.getElementById('photoPlaceholder').classList.add('hidden');
            const certPhoto = document.getElementById('cert-user-photo');
            if (certPhoto) certPhoto.src = userData.photo;
        }

        // --- TOAST NOTIFICATIONS ---
        function showToast(message, type = 'error') {
            // Remove existing toast if any
            const existingToast = document.getElementById('toast-notification');
            if (existingToast) existingToast.remove();

            const toast = document.createElement('div');
            toast.id = 'toast-notification';
            toast.className = `fixed top-24 left-1/2 transform -translate-x-1/2 px-6 py-4 rounded-xl shadow-2xl z-[100] flex items-center gap-3 transition-all duration-300 opacity-0 translate-y-[-20px] ${type === 'error' ? 'bg-red-50 border border-red-200 text-red-800' : 'bg-green-50 border border-green-200 text-green-800'
                }`;

            const icon = type === 'error' ? 'error_outline' : 'check_circle';
            toast.innerHTML = `
                <span class="material-icons-outlined text-2xl">${icon}</span>
                <span class="font-bold text-sm tracking-wide">${message}</span>
                <button onclick="this.parentElement.remove()" class="ml-4 opacity-50 hover:opacity-100"><span class="material-icons-outlined text-lg">close</span></button>
            `;

            document.body.appendChild(toast);

            // Animate in
            requestAnimationFrame(() => {
                toast.classList.remove('opacity-0', 'translate-y-[-20px]');
            });

            // Auto dismiss after 4 seconds
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    toast.classList.add('opacity-0', 'translate-y-[-20px]');
                    setTimeout(() => toast.remove(), 300);
                }
            }, 4000);
        }

        // --- FORM HELPERS ---
        function sanitizeInput(str) {
            const temp = document.createElement('div'); temp.textContent = str; return temp.innerHTML;
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            const honeypot = document.getElementById('website_field');
            if (honeypot && honeypot.value) return;

            const fullName = document.getElementById('fullName').value;
            const phone = document.getElementById('phone').value;

            if (!fullName || !phone) return showToast("Please fill in all required fields.", "error");
            if (!userData.photo) return showToast("Please upload or capture a photo.", "error");
            if (!document.getElementById('consentCheckbox').checked) return showToast("You must agree to the privacy policy.", "error");

            showLoading("Generating preview...");
            runAfterPaint(() => {
                userData.fullName = sanitizeInput(fullName);
                userData.countryCode = document.getElementById('countryCode').value;
                userData.phoneNumber = phone;
                userData.phone = `${userData.countryCode} ${phone}`;
                userData.email = sanitizeInput(document.getElementById('email').value);
                userData.privacyConsent = true;
                userData.marketingOptIn = document.getElementById('marketingCheckbox').checked;
                hideLoading();
                goToStep('preview');
            });
        }

        function updateCertificateDOM() {
            document.getElementById('cert-user-name').textContent = userData.fullName;
            const certPhoto = document.getElementById('cert-user-photo');
            if (certPhoto) certPhoto.src = userData.photo;
        }

        function finalizeCertificate() {
            showLoading("Finalizing...");
            runAfterPaint(() => {
                submitToGoogleSheet();
                hideLoading();
                const certNode = document.querySelector('#certificate-visual').parentNode;
                document.getElementById('final-cert-container').appendChild(certNode);
                goToStep('success');
            });
        }

        // Metrics Rotation Logic
        const metricsData = [
            {
                tag: "Our Community",
                title: "Volunteers Mobilized",
                value: "107k+",
                unit: "people",
                unitIcon: "people",
                desc: "Join over 100,000 volunteers making a visible difference. Together, we are a force for change.",
                color: "text-primary",
                unitColor: "text-primary",
                bgIcon: "groups"
            },
            {
                tag: "Global Impact",
                title: "Beach Cleanups",
                value: "750+",
                unit: "",
                unitIcon: "",
                desc: "Organized efforts across multiple coastlines, bringing communities together for a common cause.",
                color: "text-primary",
                unitColor: "text-primary",
                bgIcon: "public"
            },
            {
                tag: "Cleaned",
                title: "Trash Removed",
                value: "973+",
                unit: "tons",
                unitIcon: "",
                desc: "Massive amounts of plastic and debris removed, preventing them from harming marine life.",
                color: "text-emerald-400",
                unitColor: "text-emerald-500/80",
                bgIcon: "delete_outline"
            },
            {
                tag: "Restored",
                title: "Coastal Conservation",
                value: "15+",
                unit: "years",
                unitIcon: "",
                desc: "A decade and a half of persistent dedication to restoring the natural beauty of our shores.",
                color: "text-teal-400",
                unitColor: "text-teal-500/80",
                bgIcon: "volunteer_activism"
            }
        ];

        let currentMetricIndex = 0;

        function renderMetrics() {
            const mainContainer = document.getElementById('metric-main-container');
            const listContainer = document.getElementById('metric-list-container');

            // Fade out main content
            mainContainer.style.opacity = '0';
            mainContainer.style.transform = 'translateY(10px) scale(0.98)';

            setTimeout(() => {
                // Update Main Content
                const mainData = metricsData[currentMetricIndex];
                document.getElementById('metric-main-tag').textContent = mainData.tag;
                document.getElementById('metric-main-title').textContent = mainData.title;
                const valueEl = document.getElementById('metric-main-value');
                valueEl.textContent = mainData.value;
                // Reset styling/icon logic if needed, currently reusing white text for main value

                const unitEl = document.getElementById('metric-main-unit');
                if (mainData.unitIcon) {
                    unitEl.className = `${mainData.unitColor} text-5xl md:text-6xl material-icons-outlined transform translate-y-2`;
                    unitEl.textContent = mainData.unitIcon;
                    unitEl.style.display = 'inline-block';
                } else if (mainData.unit) {
                    unitEl.className = `${mainData.unitColor} text-4xl md:text-5xl font-bold ml-2`;
                    unitEl.textContent = mainData.unit;
                    unitEl.style.display = 'inline-block';
                } else {
                    unitEl.style.display = 'none';
                }

                document.getElementById('metric-main-desc').textContent = mainData.desc;
                document.getElementById('metric-bg-icon').textContent = mainData.bgIcon;

                // Update List Content
                listContainer.innerHTML = '';

                // We want to show the next 3 items in the cycle
                for (let i = 1; i <= 3; i++) {
                    const idx = (currentMetricIndex + i) % metricsData.length;
                    const item = metricsData[idx];

                    const div = document.createElement('div');
                    div.className = "flex items-center justify-between group cursor-default transition-all duration-300 hover:translate-x-1";
                    div.innerHTML = `
                        <div>
                            <p class="text-slate-400 text-sm font-medium uppercase tracking-wider mb-1">${item.tag}</p>
                            <h4 class="text-2xl font-semibold text-white">${item.title}</h4>
                        </div>
                        <div class="text-right">
                            <div class="flex items-baseline justify-end gap-1">
                                <span class="block font-display text-5xl ${item.color} font-bold transform transition-transform group-hover:scale-105 origin-right">${item.value}</span>
                                ${item.unit ? `<span class="text-xl ${item.unitColor} font-medium">${item.unit}</span>` : ''}
                            </div>
                        </div>
                    `;

                    listContainer.appendChild(div);

                    // Add separator if not last
                    if (i < 3) {
                        const sep = document.createElement('div');
                        sep.className = "h-px w-full bg-gradient-to-r from-transparent via-slate-600/50 to-transparent";
                        listContainer.appendChild(sep);
                    }
                }

                // Fade in main content
                mainContainer.style.opacity = '1';
                mainContainer.style.transform = 'translateY(0) scale(1)';
            }, 300);
        }

        // Rotate every 2.0 seconds as requested
        setInterval(() => {
            currentMetricIndex = (currentMetricIndex + 1) % metricsData.length;
            renderMetrics();
        }, 2000);

        // Initial Render
        document.addEventListener('DOMContentLoaded', () => {
            renderMetrics();
        });

        // --- UTILS ---
        function showLoading(msg) {
            document.getElementById('loading-text').textContent = msg;
            document.getElementById('loading-overlay').classList.remove('hidden');
            document.getElementById('loading-overlay').classList.add('flex');
        }
        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
            document.getElementById('loading-overlay').classList.remove('flex');
        }
        function runAfterPaint(cb) { setTimeout(cb, 16); }

        function downloadPDF() {
            showLoading("Downloading...");
            runAfterPaint(() => {
                const certElement = document.getElementById('certificate-visual');
                html2canvas(certElement, { scale: 3, useCORS: true, backgroundColor: '#ffffff' }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `Certificate-${userData.fullName.replace(/\s+/g, '-')}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    hideLoading();
                });
            });
        }

        function shareImpact() {
            showLoading("Sharing...");
            runAfterPaint(() => {
                const certElement = document.getElementById('certificate-visual');
                html2canvas(certElement, { scale: 3, useCORS: true, backgroundColor: '#ffffff' }).then(canvas => {
                    canvas.toBlob(blob => {
                        if (blob && navigator.share) {
                            const file = new File([blob], 'cert.png', { type: 'image/png' });
                            navigator.share({ files: [file], title: 'PureShores Certificate' }).then(() => hideLoading()).catch(() => hideLoading());
                        } else {
                            hideLoading();
                            downloadPDF();
                        }
                    }, 'image/png');
                });
            });
        }

        function resetApp() {
            window.location.reload();
        }

        initCountries();
    </script>
</body>

</html>